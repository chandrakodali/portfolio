<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Terraform at Scale: Module Design Patterns | Chandra Koushik Kodali</title>
    <meta name="description"
        content="Learn how to design reusable Terraform modules, implement state management strategies, and build scalable infrastructure-as-code for enterprise environments.">
    <meta name="author" content="Chandra Koushik Kodali">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0a0a;
            --bg-secondary: #111111;
            --bg-tertiary: #1a1a1a;
            --text-primary: #ffffff;
            --text-secondary: #a3a3a3;
            --text-muted: #737373;
            --accent-cyan: #06b6d4;
            --accent-purple: #8b5cf6;
            --accent-green: #10b981;
            --accent-orange: #f59e0b;
            --accent-red: #ef4444;
            --border-color: #262626;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: var(--bg-primary);
            color: var(--text-secondary);
            line-height: 1.7;
            min-height: 100vh;
        }

        .article-header {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            padding: 24px 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 32px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            transition: color 0.2s;
        }

        .back-link:hover {
            color: var(--accent-green);
        }

        .header-meta {
            display: flex;
            align-items: center;
            gap: 16px;
            font-size: 13px;
            color: var(--text-muted);
        }

        .article-layout {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 48px;
            padding: 48px 32px;
        }

        @media (max-width: 1200px) {
            .article-layout {
                grid-template-columns: 1fr;
            }

            .architecture-sidebar {
                display: none;
            }

            .architecture-inline {
                display: block !important;
            }
        }

        .article-content {
            max-width: 720px;
        }

        .article-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--text-primary);
            line-height: 1.2;
            margin-bottom: 16px;
        }

        .article-subtitle {
            font-size: 1.25rem;
            color: var(--text-secondary);
            margin-bottom: 32px;
            line-height: 1.6;
        }

        .tag {
            display: inline-block;
            padding: 4px 12px;
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 4px;
            color: var(--accent-green);
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 16px;
        }

        h2 {
            font-size: 1.5rem;
            color: var(--text-primary);
            margin: 56px 0 20px;
            padding-top: 24px;
            border-top: 1px solid var(--border-color);
        }

        h2:first-of-type {
            margin-top: 32px;
            padding-top: 0;
            border-top: none;
        }

        h3 {
            font-size: 1.2rem;
            color: var(--text-primary);
            margin: 32px 0 12px;
        }

        h4 {
            font-size: 1rem;
            color: var(--text-secondary);
            margin: 24px 0 8px;
        }

        p {
            margin-bottom: 20px;
        }

        ul,
        ol {
            margin: 0 0 24px 20px;
        }

        li {
            margin-bottom: 8px;
        }

        strong {
            color: var(--text-primary);
            font-weight: 600;
        }

        .code-block {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            overflow-x: auto;
            font-family: 'JetBrains Mono', monospace;
            font-size: 13px;
            line-height: 1.6;
            color: #e5e7eb;
        }

        .code-block code {
            white-space: pre;
        }

        .callout {
            border-radius: 8px;
            padding: 16px 20px;
            margin: 24px 0;
        }

        .callout-info {
            background: rgba(16, 185, 129, 0.1);
            border-left: 3px solid var(--accent-green);
        }

        .callout-warning {
            background: rgba(245, 158, 11, 0.1);
            border-left: 3px solid var(--accent-orange);
        }

        .callout-danger {
            background: rgba(239, 68, 68, 0.1);
            border-left: 3px solid var(--accent-red);
        }

        .callout-success {
            background: rgba(6, 182, 212, 0.1);
            border-left: 3px solid var(--accent-cyan);
        }

        .callout-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
            font-size: 14px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 24px 0;
            font-size: 14px;
        }

        th,
        td {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        th {
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-weight: 600;
        }

        .architecture-sidebar {
            position: sticky;
            top: 100px;
            height: fit-content;
            max-height: calc(100vh - 140px);
            overflow-y: auto;
        }

        .architecture-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
        }

        .architecture-card-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .architecture-card-title::before {
            content: '';
            width: 8px;
            height: 8px;
            background: var(--accent-green);
            border-radius: 50%;
        }

        .arch-diagram {
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 16px;
        }

        .arch-diagram svg {
            width: 100%;
            height: auto;
        }

        .architecture-inline {
            display: none;
            margin: 32px 0;
        }

        .toc-sidebar {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 24px;
        }

        .toc-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 16px;
        }

        .toc-list {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .toc-list li {
            margin-bottom: 8px;
        }

        .toc-list a {
            font-size: 13px;
            color: var(--text-muted);
            text-decoration: none;
            transition: color 0.2s;
            display: block;
            padding: 4px 0;
        }

        .toc-list a:hover {
            color: var(--accent-green);
        }

        .tree {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            font-family: 'JetBrains Mono', monospace;
            font-size: 13px;
            line-height: 1.6;
            overflow-x: auto;
        }

        .tree pre {
            margin: 0;
            color: var(--text-muted);
        }

        .tree .folder {
            color: var(--accent-green);
        }

        .tree .file {
            color: var(--text-secondary);
        }

        .article-footer {
            max-width: 720px;
            margin: 64px 0;
            padding-top: 32px;
            border-top: 1px solid var(--border-color);
        }

        .cta-section {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 32px;
            text-align: center;
        }

        .cta-title {
            font-size: 1.25rem;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .cta-text {
            color: var(--text-secondary);
            margin-bottom: 20px;
        }

        .cta-button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: var(--accent-green);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            font-size: 14px;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .cta-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(16, 185, 129, 0.3);
        }

        .key-takeaways {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 24px;
            margin: 32px 0;
        }

        .key-takeaways h3 {
            margin-top: 0;
            color: var(--accent-cyan);
        }

        .key-takeaways ol {
            margin-bottom: 0;
        }
    </style>
</head>

<body>
    <header class="article-header">
        <div class="header-content">
            <a href="/portfolio/#blog" class="back-link">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 12H5M12 19l-7-7 7-7" />
                </svg>
                Back to Portfolio
            </a>
            <div class="header-meta">
                <span>24 min read</span>
                <span>‚Ä¢</span>
                <span>Infrastructure</span>
            </div>
        </div>
    </header>

    <main class="article-layout">
        <article class="article-content">
            <span class="tag">Infrastructure</span>
            <h1 class="article-title">Terraform at Scale: Module Design Patterns</h1>
            <p class="article-subtitle">Learn how to design reusable Terraform modules, implement state management
                strategies, and build scalable infrastructure-as-code for enterprise environments.</p>

            <h2 id="introduction">Why Module Design Matters</h2>
            <p>
                Infrastructure as Code (IaC) with Terraform has become the standard for managing cloud infrastructure.
                However, as organizations scale from a handful of resources to thousands across multiple teams and
                environments, the challenges of maintainability, consistency, and collaboration become critical.
            </p>

            <div class="callout callout-info">
                <div class="callout-title">üí° The Module Philosophy</div>
                <p>A well-designed module is like a good API: it hides complexity, provides sensible defaults, and is
                    impossible to misuse. Users should understand what it does just by reading variables.tf and
                    outputs.tf.</p>
            </div>

            <!-- Mobile Architecture -->
            <div class="architecture-inline">
                <div class="architecture-card">
                    <div class="architecture-card-title">Module Composition</div>
                    <div class="arch-diagram">
                        <svg viewBox="0 0 350 200" xmlns="http://www.w3.org/2000/svg">
                            <rect x="100" y="10" width="150" height="40" rx="6" fill="#1a1a1a" stroke="#10b981"
                                stroke-width="2" />
                            <text x="175" y="35" fill="#10b981" font-size="11" text-anchor="middle"
                                font-weight="600">Root Module</text>

                            <rect x="20" y="80" width="100" height="35" rx="4" fill="#1a1a1a" stroke="#06b6d4"
                                stroke-width="1.5" />
                            <text x="70" y="102" fill="#06b6d4" font-size="10" text-anchor="middle">VPC Module</text>

                            <rect x="130" y="80" width="100" height="35" rx="4" fill="#1a1a1a" stroke="#8b5cf6"
                                stroke-width="1.5" />
                            <text x="180" y="102" fill="#8b5cf6" font-size="10" text-anchor="middle">EKS Module</text>

                            <rect x="240" y="80" width="100" height="35" rx="4" fill="#1a1a1a" stroke="#f59e0b"
                                stroke-width="1.5" />
                            <text x="290" y="102" fill="#f59e0b" font-size="10" text-anchor="middle">RDS Module</text>

                            <path d="M150 50 L70 80" stroke="#525252" stroke-width="1.5" />
                            <path d="M175 50 L180 80" stroke="#525252" stroke-width="1.5" />
                            <path d="M200 50 L290 80" stroke="#525252" stroke-width="1.5" />
                        </svg>
                    </div>
                </div>
            </div>

            <h2 id="design-principles">Module Design Principles</h2>

            <h3>Single Responsibility</h3>
            <p>Each module should do one thing well. A VPC module creates networking. An EKS module creates Kubernetes
                clusters. Don't combine unrelated resources.</p>

            <h3>Sensible Defaults</h3>
            <p>Provide reasonable defaults while allowing complete customization:</p>

            <div class="code-block"><code>variable "instance_type" {
  description = "EC2 instance type"
  type        = string
  default     = "t3.medium"  # Sensible default
}

variable "enable_monitoring" {
  description = "Enable detailed CloudWatch monitoring"
  type        = bool
  default     = true  # Safe default
}

variable "tags" {
  description = "Additional tags to apply to resources"
  type        = map(string)
  default     = {}  # Allow complete customization
}</code></div>

            <h3>Explicit Over Implicit</h3>
            <p>Make dependencies and requirements explicit:</p>

            <div class="code-block"><code># Bad: Implicit dependency on default VPC
resource "aws_instance" "example" {
  ami           = var.ami_id
  instance_type = var.instance_type
}

# Good: Explicit subnet requirement
resource "aws_instance" "example" {
  ami                    = var.ami_id
  instance_type          = var.instance_type
  subnet_id              = var.subnet_id  # Explicit
  vpc_security_group_ids = var.security_group_ids
}</code></div>

            <h2 id="module-structure">Standard Module Structure</h2>

            <div class="tree">
                <pre><span class="folder">terraform-aws-eks/</span>
‚îú‚îÄ‚îÄ <span class="file">README.md</span>           # Documentation with examples
‚îú‚îÄ‚îÄ <span class="file">main.tf</span>             # Primary resource definitions
‚îú‚îÄ‚îÄ <span class="file">variables.tf</span>        # Input variable definitions
‚îú‚îÄ‚îÄ <span class="file">outputs.tf</span>          # Output value definitions
‚îú‚îÄ‚îÄ <span class="file">versions.tf</span>         # Provider version constraints
‚îú‚îÄ‚îÄ <span class="file">locals.tf</span>           # Local value definitions
‚îú‚îÄ‚îÄ <span class="folder">modules/</span>            # Nested submodules
‚îÇ   ‚îú‚îÄ‚îÄ <span class="folder">node-group/</span>
‚îÇ   ‚îî‚îÄ‚îÄ <span class="folder">addons/</span>
‚îú‚îÄ‚îÄ <span class="folder">examples/</span>           # Usage examples
‚îÇ   ‚îú‚îÄ‚îÄ <span class="folder">complete/</span>
‚îÇ   ‚îî‚îÄ‚îÄ <span class="folder">minimal/</span>
‚îî‚îÄ‚îÄ <span class="folder">test/</span>               # Automated tests
    ‚îî‚îÄ‚îÄ <span class="file">eks_test.go</span></pre>
            </div>

            <h3>Variables with Validation</h3>

            <div class="code-block"><code>variable "cluster_name" {
  description = "Name of the EKS cluster"
  type        = string

  validation {
    condition     = can(regex("^[a-zA-Z][a-zA-Z0-9-]*$", var.cluster_name))
    error_message = "Cluster name must start with a letter."
  }
}

variable "cluster_version" {
  description = "Kubernetes version"
  type        = string
  default     = "1.28"

  validation {
    condition     = contains(["1.27", "1.28", "1.29"], var.cluster_version)
    error_message = "Version must be 1.27, 1.28, or 1.29."
  }
}</code></div>

            <h2 id="composition-patterns">Composition Patterns</h2>

            <h3>Module Composition</h3>
            <p>Build complex infrastructure from focused modules:</p>

            <div class="code-block"><code>module "vpc" {
  source  = "terraform-aws-modules/vpc/aws"
  version = "5.0.0"

  name = "${var.environment}-vpc"
  cidr = var.vpc_cidr

  azs             = var.availability_zones
  private_subnets = var.private_subnet_cidrs
  public_subnets  = var.public_subnet_cidrs

  enable_nat_gateway = true
  single_nat_gateway = var.environment != "prod"

  tags = local.common_tags
}

module "eks" {
  source = "./modules/eks"

  cluster_name = "${var.environment}-cluster"
  vpc_id       = module.vpc.vpc_id
  subnet_ids   = module.vpc.private_subnets

  tags = local.common_tags
}</code></div>

            <h3>Factory Pattern</h3>
            <p>For standardized deployments across many environments:</p>

            <div class="code-block"><code>variable "environments" {
  type = map(object({
    vpc_cidr      = string
    instance_type = string
    node_count    = number
  }))
}

module "environment" {
  source   = "../modules/environment"
  for_each = var.environments

  environment   = each.key
  vpc_cidr      = each.value.vpc_cidr
  instance_type = each.value.instance_type
  node_count    = each.value.node_count
}

# terraform.tfvars
environments = {
  dev     = { vpc_cidr = "10.0.0.0/16", instance_type = "t3.medium", node_count = 2 }
  staging = { vpc_cidr = "10.1.0.0/16", instance_type = "t3.large",  node_count = 3 }
  prod    = { vpc_cidr = "10.2.0.0/16", instance_type = "m5.xlarge", node_count = 5 }
}</code></div>

            <h2 id="state-management">State Management</h2>

            <h3>Remote State Backend</h3>

            <div class="code-block"><code>terraform {
  backend "s3" {
    bucket         = "company-terraform-state"
    key            = "environments/prod/eks/terraform.tfstate"
    region         = "us-east-1"
    encrypt        = true
    dynamodb_table = "terraform-state-lock"
  }
}</code></div>

            <h3>State Isolation Strategies</h3>
            <table>
                <tr>
                    <th>Strategy</th>
                    <th>When to Use</th>
                    <th>Tradeoffs</th>
                </tr>
                <tr>
                    <td>Per-environment</td>
                    <td>Complete isolation</td>
                    <td>Cannot share resources</td>
                </tr>
                <tr>
                    <td>Per-component</td>
                    <td>Independent lifecycles</td>
                    <td>Requires data sources</td>
                </tr>
                <tr>
                    <td>Monolithic</td>
                    <td>Small projects</td>
                    <td>Large blast radius</td>
                </tr>
            </table>

            <div class="callout callout-warning">
                <div class="callout-title">‚ö†Ô∏è Cross-State Dependencies</div>
                <p>When referencing other state files, document these relationships clearly. Consider using explicit
                    data sources instead for better discoverability.</p>
            </div>

            <h2 id="testing">Testing Strategies</h2>

            <h3>Static Analysis</h3>
            <div class="code-block"><code># .pre-commit-config.yaml
repos:
  - repo: https://github.com/antonbabenko/pre-commit-terraform
    hooks:
      - id: terraform_fmt
      - id: terraform_validate
      - id: terraform_tflint
      - id: terraform_checkov</code></div>

            <h3>Unit Tests with Terratest</h3>
            <div class="code-block"><code>func TestEKSModule(t *testing.T) {
    t.Parallel()

    terraformOptions := &terraform.Options{
        TerraformDir: "../examples/minimal",
        Vars: map[string]interface{}{
            "cluster_name": "test-cluster",
        },
    }

    defer terraform.Destroy(t, terraformOptions)
    terraform.InitAndApply(t, terraformOptions)

    endpoint := terraform.Output(t, terraformOptions, "cluster_endpoint")
    assert.Contains(t, endpoint, "eks.amazonaws.com")
}</code></div>

            <h2 id="cicd">CI/CD Integration</h2>

            <div class="code-block"><code># .github/workflows/terraform.yml
name: Terraform

on:
  pull_request:
    branches: [main]
  push:
    branches: [main]

jobs:
  plan:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - uses: hashicorp/setup-terraform@v3
      
      - name: Terraform Format
        run: terraform fmt -check -recursive
      
      - name: Terraform Init
        run: terraform init
      
      - name: Terraform Plan
        run: terraform plan -out=tfplan

  apply:
    needs: plan
    if: github.ref == 'refs/heads/main'
    runs-on: ubuntu-latest
    environment: production
    steps:
      - name: Terraform Apply
        run: terraform apply -auto-approve</code></div>

            <h2 id="security">Security Best Practices</h2>

            <h3>Least Privilege IAM</h3>
            <div class="code-block"><code>data "aws_iam_policy_document" "terraform" {
  statement {
    effect = "Allow"
    actions = [
      "eks:*",
      "ec2:Describe*",
      "ec2:CreateSecurityGroup",
    ]
    resources = ["*"]
    condition {
      test     = "StringEquals"
      variable = "aws:RequestedRegion"
      values   = ["us-east-1"]
    }
  }
}</code></div>

            <h3>Secrets Handling</h3>
            <div class="code-block"><code># Never store secrets in variables
# Use data sources to fetch at apply time

data "aws_secretsmanager_secret_version" "db_password" {
  secret_id = "prod/database/master-password"
}

resource "aws_db_instance" "main" {
  password = data.aws_secretsmanager_secret_version.db_password.secret_string
}</code></div>

            <h2 id="troubleshooting">Common Issues</h2>

            <div class="callout callout-danger">
                <div class="callout-title">üîß State Lock Stuck</div>
                <p>If state lock isn't released after a failed apply:</p>
            </div>

            <div class="code-block"><code># Force unlock (use with caution!)
terraform force-unlock LOCK_ID

# Check DynamoDB for stuck locks
aws dynamodb scan --table-name terraform-state-lock</code></div>

            <div class="callout callout-warning">
                <div class="callout-title">‚ö†Ô∏è Resource Already Exists</div>
                <p>Import existing resources into state:</p>
            </div>

            <div class="code-block"><code>terraform import aws_s3_bucket.example my-existing-bucket
terraform plan  # Verify state matches</code></div>

            <div class="key-takeaways">
                <h3>üéØ Key Takeaways</h3>
                <ol>
                    <li><strong>Design for reuse:</strong> Build modules with clear interfaces and sensible defaults
                    </li>
                    <li><strong>Isolate state:</strong> Separate state files per environment and component</li>
                    <li><strong>Test everything:</strong> Static analysis, unit tests, and policy checks</li>
                    <li><strong>Version carefully:</strong> Use semantic versioning with migration guides</li>
                    <li><strong>Secure by default:</strong> Least privilege IAM, encrypted state, no secrets in code
                    </li>
                    <li><strong>Plan for scale:</strong> Multi-account, multi-region patterns from the start</li>
                </ol>
            </div>

            <div class="article-footer">
                <div class="cta-section">
                    <h3 class="cta-title">Need help scaling your Terraform?</h3>
                    <p class="cta-text">Let's discuss module design patterns for your organization.</p>
                    <a href="/portfolio/#contact" class="cta-button">
                        Get in Touch
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M5 12h14M12 5l7 7-7 7" />
                        </svg>
                    </a>
                </div>
            </div>
        </article>

        <!-- Architecture Sidebar -->
        <aside class="architecture-sidebar">
            <div class="architecture-card">
                <div class="architecture-card-title">Module Composition</div>
                <div class="arch-diagram">
                    <svg viewBox="0 0 350 260" xmlns="http://www.w3.org/2000/svg">
                        <!-- Root Module -->
                        <rect x="100" y="10" width="150" height="50" rx="8" fill="#0a0a0a" stroke="#10b981"
                            stroke-width="2" />
                        <text x="175" y="32" fill="#10b981" font-size="11" text-anchor="middle" font-weight="600">Root
                            Module</text>
                        <text x="175" y="48" fill="#737373" font-size="9" text-anchor="middle">environments/prod</text>

                        <!-- Child Modules -->
                        <rect x="15" y="100" width="100" height="45" rx="6" fill="#0a0a0a" stroke="#06b6d4"
                            stroke-width="1.5" />
                        <text x="65" y="120" fill="#06b6d4" font-size="10" text-anchor="middle" font-weight="500">VPC
                            Module</text>
                        <text x="65" y="135" fill="#737373" font-size="8" text-anchor="middle">Networking</text>

                        <rect x="125" y="100" width="100" height="45" rx="6" fill="#0a0a0a" stroke="#8b5cf6"
                            stroke-width="1.5" />
                        <text x="175" y="120" fill="#8b5cf6" font-size="10" text-anchor="middle" font-weight="500">EKS
                            Module</text>
                        <text x="175" y="135" fill="#737373" font-size="8" text-anchor="middle">Kubernetes</text>

                        <rect x="235" y="100" width="100" height="45" rx="6" fill="#0a0a0a" stroke="#f59e0b"
                            stroke-width="1.5" />
                        <text x="285" y="120" fill="#f59e0b" font-size="10" text-anchor="middle" font-weight="500">RDS
                            Module</text>
                        <text x="285" y="135" fill="#737373" font-size="8" text-anchor="middle">Database</text>

                        <!-- Sub-modules -->
                        <rect x="100" y="180" width="70" height="30" rx="4" fill="#1a1a1a" />
                        <text x="135" y="200" fill="#a3a3a3" font-size="8" text-anchor="middle">node-group</text>

                        <rect x="180" y="180" width="70" height="30" rx="4" fill="#1a1a1a" />
                        <text x="215" y="200" fill="#a3a3a3" font-size="8" text-anchor="middle">addons</text>

                        <!-- Cloud -->
                        <rect x="35" y="225" width="280" height="30" rx="4" fill="#0a0a0a" stroke="#525252"
                            stroke-width="1" />
                        <text x="175" y="245" fill="#737373" font-size="10" text-anchor="middle">AWS / GCP /
                            Azure</text>

                        <!-- Arrows -->
                        <path d="M145 60 L65 100" stroke="#525252" stroke-width="1.5" />
                        <path d="M175 60 L175 100" stroke="#525252" stroke-width="1.5" />
                        <path d="M205 60 L285 100" stroke="#525252" stroke-width="1.5" />
                        <path d="M155 145 L135 180" stroke="#525252" stroke-width="1" />
                        <path d="M195 145 L215 180" stroke="#525252" stroke-width="1" />
                    </svg>
                </div>
                <p style="font-size: 12px; color: var(--text-muted); margin: 0;">
                    Root modules compose child modules, which may have nested sub-modules for specific features.
                </p>
            </div>

            <div class="architecture-card">
                <div class="architecture-card-title">State Management</div>
                <div class="arch-diagram">
                    <svg viewBox="0 0 350 200" xmlns="http://www.w3.org/2000/svg">
                        <!-- Terraform -->
                        <rect x="10" y="75" width="80" height="50" rx="6" fill="#0a0a0a" stroke="#8b5cf6"
                            stroke-width="2" />
                        <text x="50" y="100" fill="#8b5cf6" font-size="10" text-anchor="middle"
                            font-weight="600">Terraform</text>
                        <text x="50" y="115" fill="#737373" font-size="8" text-anchor="middle">CLI/CI</text>

                        <!-- S3 Bucket -->
                        <rect x="135" y="20" width="80" height="40" rx="4" fill="#0a0a0a" stroke="#f59e0b"
                            stroke-width="1.5" />
                        <text x="175" y="45" fill="#f59e0b" font-size="9" text-anchor="middle" font-weight="500">S3
                            Bucket</text>

                        <!-- DynamoDB -->
                        <rect x="135" y="80" width="80" height="40" rx="4" fill="#0a0a0a" stroke="#06b6d4"
                            stroke-width="1.5" />
                        <text x="175" y="100" fill="#06b6d4" font-size="9" text-anchor="middle"
                            font-weight="500">DynamoDB</text>
                        <text x="175" y="112" fill="#737373" font-size="7" text-anchor="middle">Locking</text>

                        <!-- State Files -->
                        <rect x="260" y="10" width="80" height="25" rx="3" fill="#1a1a1a" />
                        <text x="300" y="27" fill="#a3a3a3" font-size="7" text-anchor="middle">dev.tfstate</text>

                        <rect x="260" y="45" width="80" height="25" rx="3" fill="#1a1a1a" />
                        <text x="300" y="62" fill="#a3a3a3" font-size="7" text-anchor="middle">staging.tfstate</text>

                        <rect x="260" y="80" width="80" height="25" rx="3" fill="#1a1a1a" />
                        <text x="300" y="97" fill="#a3a3a3" font-size="7" text-anchor="middle">prod.tfstate</text>

                        <!-- Arrows -->
                        <path d="M90 90 L135 45" stroke="#525252" stroke-width="1.5" />
                        <path d="M90 100 L135 100" stroke="#525252" stroke-width="1.5" />
                        <path d="M215 40 L260 30" stroke="#525252" stroke-width="1" />
                        <path d="M215 40 L260 55" stroke="#525252" stroke-width="1" />
                        <path d="M215 40 L260 90" stroke="#525252" stroke-width="1" />

                        <!-- Legend -->
                        <text x="175" y="150" fill="#737373" font-size="9" text-anchor="middle">Encrypted state with
                            locking</text>
                        <text x="175" y="165" fill="#737373" font-size="9" text-anchor="middle">prevents concurrent
                            modifications</text>
                    </svg>
                </div>
                <p style="font-size: 12px; color: var(--text-muted); margin: 0;">
                    Remote state with S3 and DynamoDB ensures consistency across team members.
                </p>
            </div>

            <div class="toc-sidebar">
                <div class="toc-title">On This Page</div>
                <ul class="toc-list">
                    <li><a href="#introduction">Why Module Design Matters</a></li>
                    <li><a href="#design-principles">Design Principles</a></li>
                    <li><a href="#module-structure">Module Structure</a></li>
                    <li><a href="#composition-patterns">Composition Patterns</a></li>
                    <li><a href="#state-management">State Management</a></li>
                    <li><a href="#testing">Testing Strategies</a></li>
                    <li><a href="#cicd">CI/CD Integration</a></li>
                    <li><a href="#security">Security</a></li>
                    <li><a href="#troubleshooting">Troubleshooting</a></li>
                </ul>
            </div>
        </aside>
    </main>
</body>

</html>